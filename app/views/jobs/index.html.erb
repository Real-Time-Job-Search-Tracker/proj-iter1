<div class="container">

  <div class="card">
    <div class="panel-header">
      <h2>Add an application</h2>
    </div>

    <%# === Rails-friendly form that tests expect === %>
    <%= form_with url: applications_path, method: :post, id: "new_application", data: { turbo: false } do %>
      <div>
        <%= label_tag "application[url]", "Final apply URL" %>
        <%= text_field_tag "application[url]", "", id: "application_url", type: "url", placeholder: "Paste a job URL (Lever/Greenhouse/…)" %>
      </div>

      <div>
        <%= label_tag "application[company]", "Company (optional)" %>
        <%= text_field_tag "application[company]", "", id: "application_company" %>
      </div>

      <div>
        <%= label_tag "application[title]", "Title (optional)" %>
        <%= text_field_tag "application[title]", "", id: "application_title" %>
      </div>

      <div>
        <%= label_tag "application[status]", "Status" %>
        <%= select_tag "application[status]",
              options_for_select(%w[Applied Round1 Round2 Interview Offer Accepted Declined], "Applied"),
              id: "application_status" %>
      </div>

      <%= submit_tag "Add Application" %>
    <% end %>

    <div class="msg" id="msg"></div>
  </div>

  <div class="section card">
    <h2>Funnel (Sankey)</h2>
    <div id="sankey"></div>
  </div>

  <div class="section card">
    <div class="panel-header" style="display:flex;justify-content:space-between;align-items:center;">
      <h2 style="margin:0">Applications</h2>
      <span id="countLabel" class="muted"></span>
    </div>

    <%# === Simple server-rendered list the steps can query === %>
    <ul id="applications">
      <% JobApplication.order(created_at: :desc).each do |app| %>
        <li data-company="<%= app.company %>">
          <span class="company"><%= app.company %></span>
          <span class="stage"><%= app.status %></span>
        </li>
      <% end %>
    </ul>

    <%# You can keep your JS-driven table too; tests won’t rely on it %>
    <div class="table-wrap" style="margin-top:1rem">
      <table id="appsTable">
        <thead>
          <tr>
            <th>Company</th>
            <th>URL</th>
            <th>Status</th>
            <th style="text-align:right;">Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

</div>

<script>
  window.FAKE_JOBS = JSON.parse(<%= (@jobs || []).to_json.to_json %>);
</script>
